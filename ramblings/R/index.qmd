---
title: "R"
description: "A worthy collection of short R commands and tricks "
author: "LW Pembleton"
date-modified: last-modified
categories: [R]
image: images/daria-nepriakhina-kXDHR_bXIZo-unsplash.jpg
draft: false
highlight-style: ayu
---

![~Photo¬†by¬†Daria¬†Nepriakhina¬†on¬†Unsplash~](images/daria-nepriakhina-kXDHR_bXIZo-unsplash.jpg)

## Using {custom_annotation} to embed one plots inside another.

Embedded plots can be a powerful tool for showcasing data across an extended axis while still emphasizing specific sections.

Creating these are very easy. Here is a quick guide and example:

**Step 1:** Create your base plot.

Begin by establishing your base plot, which will serve as the canvas for your embedded plot. Typically, the base plot is the primary focus of your visualization.

```{r, warning = FALSE, message = FALSE}
library(tidyverse)
library(mdthemes)
data(mtcars)

base_plot <- ggplot(mtcars, aes(hp, mpg)) +
  geom_point(size = 4, alpha = 0.6, colour = "#22333b") +
  geom_smooth(size = 1.5, se = F, colour = "#3a86ff") +
  labs(title = "Example of a plot **embedded** within another",
    subtitle = "Using the function *'annotation_custom()'*") +
  md_theme_bw() +
  xlim(50, 200)
```

**Step 2:** Create your plot that you want to embed within the canvas.

Your embedded plot doesn't have to be the same type as your base plot. Feel free to customize it according to your data visualization needs.

```{r, warning = FALSE, message = FALSE}
embedded_plot <- ggplot(mtcars, aes(hp, mpg)) +
  geom_point(size = 4, alpha = 0.6, colour = "#22333b") +
  geom_smooth(size = 1.5, se = F, colour = "#3a86ff") +
  md_theme_bw()
```

**Step 3:** Use `custom_annotate()` to embed the plot.

Now, it's time to embed the plot within the canvas using the **`annotation_custom()`** function. You'll need to specify the X and Y positions for the embedded plot:

```{r, warning = FALSE, message = FALSE}
base_plot + annotation_custom(ggplotGrob(embedded_plot), 
                              xmin = 125, 
                              xmax = 200, 
                              ymin = 22, 
                              ymax = 35)
```

## Adding linking colours to plot titles instead of a legend

Enhancing your plot titles with linking colours üåà is a clever strategy to maximise your plot realestate by eliminating legends, all while looking fantastic!

```{r, warning = FALSE, message = FALSE, echo = FALSE}
library(ggplot2) # For plotting
library(palmerpenguins) # For the example penguin dataset
library(ggtext) # For HTML rendering of text to support colour
                # Also for Markdown rendering of text

ggplot(data = penguins, 
       aes(x = flipper_length_mm, 
           y = body_mass_g)) +
  geom_point(aes(color = species, 
                 shape = species),
                 size = 2) +
  scale_color_manual(values = c("#FF8C00","#9932CC","#008B8B")) +
  labs(title = "Penguin flipper length versus body mass",
       subtitle = "Penguin species
       <span style='color:#FF8C00;'>*Pygoscelis adeliae*</span>, 
       <span style='color:#9932CC;'>*Pygoscelis papua*</span> and 
       <span style='color:#008B8B;'>*Pygoscelis antarcticus*</span>",
       x = "Flipper Length (mm)",
       y = "Body Mass (g)")  +
  theme_minimal() +
  theme(panel.grid = element_blank(),
        plot.subtitle = element_markdown(),
        legend.position = "none")

```

To achieve this style you will need:

1.  the [{ggtext}](https://wilkelab.org/ggtext/) package which will perform the [HTML rendering](https://www.w3schools.com/tags/tag_span.asp), in this case in the subtitle to define the text colour.

2.  Adding `plot.subtitle = element_markdown()` to the theme, [{ggtext}](https://wilkelab.org/ggtext/) will perform [markdown rendering](https://docs.github.com/en/get-started/writing-on-github/getting-started-with-writing-and-formatting-on-github/basic-writing-and-formatting-syntax#styling-text), for example making specific text bold, or in the above example, italicised.

3.  and finally, adding `legend.position = "none"` also to the theme will remove the old clunky default legend

Here is the full code üëá enjoy!

```{r, eval = FALSE}
library(ggplot2) # For plotting
library(palmerpenguins) # For the example penguin dataset
library(ggtext) # For HTML rendering of text to support colour
                # Also for Markdown rendering of text

ggplot(data = penguins, 
       aes(x = flipper_length_mm, 
           y = body_mass_g)) +
  geom_point(aes(color = species, 
                 shape = species),
                 size = 2) +
  scale_color_manual(values = c("#FF8C00","#9932CC","#008B8B")) +
  labs(title = "Penguin flipper length versus body mass",
       subtitle = "Penguin species
       <span style='color:#FF8C00;'>*Pygoscelis adeliae*</span>, 
       <span style='color:#9932CC;'>*Pygoscelis papua*</span> and 
       <span style='color:#008B8B;'>*Pygoscelis antarcticus*</span>",
       x = "Flipper Length (mm)",
       y = "Body Mass (g)")  +
  theme_minimal() +
  theme(panel.grid = element_blank(),
        plot.subtitle = element_markdown(),
        legend.position = "none")

```

If you want to go a step further you can add the corresponding point shape/symbol to the subtitle as wellüéâ

```{r, warning = FALSE, message = FALSE, echo = FALSE}
library(ggplot2) # For plotting
library(palmerpenguins) # For the example penguin dataset
library(ggtext) # For HTML rendering of text to support colour
# Also for Markdown rendering of text
# Get HTML code for genometric symbols from:
# https://www.htmlsymbols.xyz/geometric-symbols

ggplot(data = penguins, 
       aes(x = flipper_length_mm, 
           y = body_mass_g)) +
  geom_point(aes(color = species, 
                 shape = species),
             size = 2) +
  scale_color_manual(values = c("#FF8C00","#9932CC","#008B8B")) +
  labs(title = "Penguin flipper length versus body mass",
       subtitle = "Penguin species
       <span style='color:#FF8C00;'>*Pygoscelis adeliae* &#9679;</span>, 
       <span style='color:#9932CC;'>*Pygoscelis papua* &#11205;</span> and 
       <span style='color:#008B8B;'>*Pygoscelis antarcticus* &#11200;</span>",
       x = "Flipper Length (mm)",
       y = "Body Mass (g)")  +
  theme_minimal() +
  theme(panel.grid = element_blank(),
        plot.subtitle = element_markdown(),
        legend.position = "none")
```

All you need to do is add the HTML Unicode (e.g. &#9679 for ‚óè) for the matching symbol/shape to the subtitle. You can look up the HTML Unicode [here](https://www.htmlsymbols.xyz/geometric-symbols).

::: callout-note
For some reason when viewing the plot in the Rstudio plot tab, additional spaces (relative to the length of the Unicode) will appear next to the symbols. However, this disappears when you render the image in a quarto document or save the plot as an image.

![](images/unicode_space.png)
:::

Here is the full code üëá enjoy!

```{r, eval = FALSE}
library(ggplot2) # For plotting
library(palmerpenguins) # For the example penguin dataset
library(ggtext) # For HTML rendering of text to support colour
# Also for Markdown rendering of text
# Get HTML code for genometric symbols from:
# https://www.htmlsymbols.xyz/geometric-symbols

ggplot(data = penguins, 
       aes(x = flipper_length_mm, 
           y = body_mass_g)) +
  geom_point(aes(color = species, 
                 shape = species),
             size = 2) +
  scale_color_manual(values = c("#FF8C00","#9932CC","#008B8B")) +
  labs(title = "Penguin flipper length versus body mass",
       subtitle = "Penguin species
       <span style='color:#FF8C00;'>*Pygoscelis adeliae* &#9679;</span>, 
       <span style='color:#9932CC;'>*Pygoscelis papua* &#11205;</span> and 
       <span style='color:#008B8B;'>*Pygoscelis antarcticus* &#11200;</span>",
       x = "Flipper Length (mm)",
       y = "Body Mass (g)")  +
  theme_minimal() +
  theme(panel.grid = element_blank(),
        plot.subtitle = element_markdown(),
        legend.position = "none")
```

## Transform axis numbers into more readable formats

Want to avoid number labels on your plots that are difficult to read or interpret such as the all too common scientific e notation as seen in this example? üëá

```{r, warning = FALSE, message = FALSE, echo = FALSE}
library(tidyverse)
library(ggplot2) # For plotting
library(ggtext) # For HTML rendering of text to support colour
                # Also for Markdown rendering of text

data <- tibble::tribble(
             ~Month,   ~Year,     ~Region, ~Production_Litres,
             "July", "22/23",       "NSW",        80742825.35,
           "August", "22/23",       "NSW",        85515267.53,
        "September", "22/23",       "NSW",        89642883.77,
          "October", "22/23",       "NSW",        92774430.63,
         "November", "22/23",       "NSW",         86431638.4,
         "December", "22/23",       "NSW",        86230113.71,
          "January", "22/23",       "NSW",        81030159.32,
         "February", "22/23",       "NSW",        72891273.03,
            "March", "22/23",       "NSW",        78366274.94,
            "April", "22/23",       "NSW",         75805741.9,
              "May", "22/23",       "NSW",        79986532.53,
             "June", "22/23",       "NSW",        80446060.32,
             "July", "22/23",       "VIC",       386373862.86,
           "August", "22/23",       "VIC",        450615318.9,
        "September", "22/23",       "VIC",       527734837.67,
          "October", "22/23",       "VIC",        575715726.1,
         "November", "22/23",       "VIC",       519338047.94,
         "December", "22/23",       "VIC",       499009041.08,
          "January", "22/23",       "VIC",       423251928.39,
         "February", "22/23",       "VIC",       323689836.55,
            "March", "22/23",       "VIC",        333750042.9,
            "April", "22/23",       "VIC",       340058086.75,
              "May", "22/23",       "VIC",        388157951.5,
             "June", "22/23",       "VIC",       373346197.82,
             "July", "22/23", "Australia",        570199372.1,
           "August", "22/23", "Australia",       659242110.71,
        "September", "22/23", "Australia",       797167795.77,
          "October", "22/23", "Australia",       888535142.24,
         "November", "22/23", "Australia",        818914946.8,
         "December", "22/23", "Australia",       790237598.05,
          "January", "22/23", "Australia",       693408820.19,
         "February", "22/23", "Australia",       553467890.76,
            "March", "22/23", "Australia",       580325765.96,
            "April", "22/23", "Australia",       577153026.75,
              "May", "22/23", "Australia",       623257518.13,
             "June", "22/23", "Australia",       576627597.06,
             "July", "23/24",       "NSW",        87662230.03,
           "August", "23/24",       "NSW",        93724243.26,
        "September", "23/24",       "NSW",        96012475.27,
             "July", "23/24",       "VIC",       382943134.47,
           "August", "23/24",       "VIC",       447394128.72,
        "September", "23/24",       "VIC",       526453329.78,
             "July", "23/24", "Australia",       576952581.71,
           "August", "23/24", "Australia",       670893737.51,
        "September", "23/24", "Australia",       809301895.87
        )
data <- data |> mutate(Month = factor(Month, levels = c("July", "August", "September", "October", "November", "December", "January", "February", "March", "April", "May", "June")))


ggplot(data = data, aes(x = Month, y = Production_Litres, colour = Region, linetype = Year, group = interaction(Region, Year))) +
  geom_smooth(se=FALSE) +
  scale_color_manual(values = c("#000000","#428bca","#b5b682")) +
  labs(title = "Australian Dairy Milk Production",
       subtitle = "<span style='color:#000000;'>**National Production**</span> and key dairy states 
         <span style='color:#b5b682;'>**Victoria**</span> and 
         <span style='color:#428bca;'>**New South Wales.**</span>",
       x = "",
       y = "Production (Litres)",
       caption = "Data Source: Dairy Australia Milk Production Report September 2023")  +
    theme_classic() +
    theme(panel.grid = element_blank(),
          plot.subtitle = element_markdown(),
          legend.position = "top") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  guides(colour = "none", linetype = guide_legend(override.aes = list(color = "#000000")))

```

The label_number_si() function from the [{scales}](https://scales.r-lib.org/) package will conveniently convert your unclear labels to a more appropriate format. Lets apply it to our example from above. ü•≥üéâ

```{r, warning = FALSE, message = FALSE, echo = FALSE}
library(ggplot2) # For plotting
library(ggtext) # For HTML rendering of text to support colour
                # Also for Markdown rendering of text

data <- tibble::tribble(
             ~Month,   ~Year,     ~Region, ~Production_Litres,
             "July", "22/23",       "NSW",        80742825.35,
           "August", "22/23",       "NSW",        85515267.53,
        "September", "22/23",       "NSW",        89642883.77,
          "October", "22/23",       "NSW",        92774430.63,
         "November", "22/23",       "NSW",         86431638.4,
         "December", "22/23",       "NSW",        86230113.71,
          "January", "22/23",       "NSW",        81030159.32,
         "February", "22/23",       "NSW",        72891273.03,
            "March", "22/23",       "NSW",        78366274.94,
            "April", "22/23",       "NSW",         75805741.9,
              "May", "22/23",       "NSW",        79986532.53,
             "June", "22/23",       "NSW",        80446060.32,
             "July", "22/23",       "VIC",       386373862.86,
           "August", "22/23",       "VIC",        450615318.9,
        "September", "22/23",       "VIC",       527734837.67,
          "October", "22/23",       "VIC",        575715726.1,
         "November", "22/23",       "VIC",       519338047.94,
         "December", "22/23",       "VIC",       499009041.08,
          "January", "22/23",       "VIC",       423251928.39,
         "February", "22/23",       "VIC",       323689836.55,
            "March", "22/23",       "VIC",        333750042.9,
            "April", "22/23",       "VIC",       340058086.75,
              "May", "22/23",       "VIC",        388157951.5,
             "June", "22/23",       "VIC",       373346197.82,
             "July", "22/23", "Australia",        570199372.1,
           "August", "22/23", "Australia",       659242110.71,
        "September", "22/23", "Australia",       797167795.77,
          "October", "22/23", "Australia",       888535142.24,
         "November", "22/23", "Australia",        818914946.8,
         "December", "22/23", "Australia",       790237598.05,
          "January", "22/23", "Australia",       693408820.19,
         "February", "22/23", "Australia",       553467890.76,
            "March", "22/23", "Australia",       580325765.96,
            "April", "22/23", "Australia",       577153026.75,
              "May", "22/23", "Australia",       623257518.13,
             "June", "22/23", "Australia",       576627597.06,
             "July", "23/24",       "NSW",        87662230.03,
           "August", "23/24",       "NSW",        93724243.26,
        "September", "23/24",       "NSW",        96012475.27,
             "July", "23/24",       "VIC",       382943134.47,
           "August", "23/24",       "VIC",       447394128.72,
        "September", "23/24",       "VIC",       526453329.78,
             "July", "23/24", "Australia",       576952581.71,
           "August", "23/24", "Australia",       670893737.51,
        "September", "23/24", "Australia",       809301895.87
        )
data <- data |> mutate(Month = factor(Month, levels = c("July", "August", "September", "October", "November", "December", "January", "February", "March", "April", "May", "June")))


ggplot(data = data, aes(x = Month, y = Production_Litres, colour = Region, linetype = Year, group = interaction(Region, Year))) +
  geom_smooth(se=FALSE) +
  scale_color_manual(values = c("#000000","#428bca","#b5b682")) +
  scale_y_continuous(labels = scales::label_number_si(), breaks=seq(0,900000000,100000000)) +
  labs(title = "Australian Dairy Milk Production",
       subtitle = "<span style='color:#000000;'>**National Production**</span> and key dairy states 
         <span style='color:#b5b682;'>**Victoria**</span> and 
         <span style='color:#428bca;'>**New South Wales.**</span>",
       x = "",
       y = "Production (Litres)",
       caption = "Data Source: Dairy Australia Milk Production Report September 2023")  +
  theme_classic() +
  theme(panel.grid = element_blank(),
        plot.subtitle = element_markdown(),
        legend.position = "top") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  guides(colour = "none", linetype = guide_legend(override.aes = list(color = "#000000")))

```

Here is the full code üëá enjoy!

```{r, eval = FALSE}
library(ggplot2) # For plotting
library(ggtext) # For HTML rendering of text to support colour
                # Also for Markdown rendering of text
library(scales)

data2 <- tibble::tribble(
             ~Month,   ~Year,     ~Region, ~Production_Litres,
             "July", "22/23",       "NSW",        80742825.35,
           "August", "22/23",       "NSW",        85515267.53,
        "September", "22/23",       "NSW",        89642883.77,
          "October", "22/23",       "NSW",        92774430.63,
         "November", "22/23",       "NSW",         86431638.4,
         "December", "22/23",       "NSW",        86230113.71,
          "January", "22/23",       "NSW",        81030159.32,
         "February", "22/23",       "NSW",        72891273.03,
            "March", "22/23",       "NSW",        78366274.94,
            "April", "22/23",       "NSW",         75805741.9,
              "May", "22/23",       "NSW",        79986532.53,
             "June", "22/23",       "NSW",        80446060.32,
             "July", "22/23",       "VIC",       386373862.86,
           "August", "22/23",       "VIC",        450615318.9,
        "September", "22/23",       "VIC",       527734837.67,
          "October", "22/23",       "VIC",        575715726.1,
         "November", "22/23",       "VIC",       519338047.94,
         "December", "22/23",       "VIC",       499009041.08,
          "January", "22/23",       "VIC",       423251928.39,
         "February", "22/23",       "VIC",       323689836.55,
            "March", "22/23",       "VIC",        333750042.9,
            "April", "22/23",       "VIC",       340058086.75,
              "May", "22/23",       "VIC",        388157951.5,
             "June", "22/23",       "VIC",       373346197.82,
             "July", "22/23", "Australia",        570199372.1,
           "August", "22/23", "Australia",       659242110.71,
        "September", "22/23", "Australia",       797167795.77,
          "October", "22/23", "Australia",       888535142.24,
         "November", "22/23", "Australia",        818914946.8,
         "December", "22/23", "Australia",       790237598.05,
          "January", "22/23", "Australia",       693408820.19,
         "February", "22/23", "Australia",       553467890.76,
            "March", "22/23", "Australia",       580325765.96,
            "April", "22/23", "Australia",       577153026.75,
              "May", "22/23", "Australia",       623257518.13,
             "June", "22/23", "Australia",       576627597.06,
             "July", "23/24",       "NSW",        87662230.03,
           "August", "23/24",       "NSW",        93724243.26,
        "September", "23/24",       "NSW",        96012475.27,
             "July", "23/24",       "VIC",       382943134.47,
           "August", "23/24",       "VIC",       447394128.72,
        "September", "23/24",       "VIC",       526453329.78,
             "July", "23/24", "Australia",       576952581.71,
           "August", "23/24", "Australia",       670893737.51,
        "September", "23/24", "Australia",       809301895.87
        )
data <- data |> mutate(Month = factor(Month, levels = c("July", "August", "September", "October", "November", "December", "January", "February", "March", "April", "May", "June")))


ggplot(data = data, aes(x = Month, y = Production_Litres, colour = Region, linetype = Year, group = interaction(Region, Year))) +
  geom_smooth(se=FALSE) +
  scale_color_manual(values = c("#000000","#428bca","#b5b682")) +
  scale_y_continuous(labels = scales::label_number_si()) +
  labs(title = "Australian Dairy Milk Production",
       subtitle = "<span style='color:#000000;'>**National Production**</span> and key dairy states 
         <span style='color:#b5b682;'>**Victoria**</span> and 
         <span style='color:#428bca;'>**New South Wales.**</span>",
       x = "",
       y = "Production (Litres)",
       caption = "Data Source: Dairy Australia Milk Production Report September 2023")  +
  theme_classic() +
  theme(panel.grid = element_blank(),
        plot.subtitle = element_markdown(),
        legend.position = "top") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  guides(colour = "none", linetype = guide_legend(override.aes = list(color = "#000000")))

```
